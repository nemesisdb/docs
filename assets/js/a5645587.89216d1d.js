"use strict";(self.webpackChunknemesisdb=self.webpackChunknemesisdb||[]).push([[3609],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>h});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},d=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),m=p(a),u=r,h=m["".concat(l,".").concat(u)]||m[u]||c[u]||i;return a?n.createElement(h,s(s({ref:t},d),{},{components:a})):n.createElement(h,s({ref:t},d))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,s=new Array(i);s[0]=u;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[m]="string"==typeof e?e:r,s[1]=o;for(var p=2;p<i;p++)s[p]=a[p];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},5326:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>c,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const i={sidebar_position:25,displayed_sidebar:"homeSidebar"},s="Persist Data",o={unversionedId:"home/persist",id:"home/persist",title:"Persist Data",description:"NemesisDB is an in-memory/cache database meaning all the data is always stored in RAM. This offers performance benefits by removing calls to the filesystem and reducing complexity, but it also means if the server shutdowns all the data is lost.",source:"@site/docs/home/persist.md",sourceDirName:"home",slug:"/home/persist",permalink:"/home/persist",draft:!1,tags:[],version:"current",sidebarPosition:25,frontMatter:{sidebar_position:25,displayed_sidebar:"homeSidebar"},sidebar:"homeSidebar",previous:{title:"Client APIs",permalink:"/home/client-apis"}},l={},p=[{value:"Data Structure",id:"data-structure",level:2},{value:"Restore Data",id:"restore-data",level:2},{value:"Performance",id:"performance",level:2}],d={toc:p},m="wrapper";function c(e){let{components:t,...a}=e;return(0,r.kt)(m,(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"persist-data"},"Persist Data"),(0,r.kt)("p",null,"NemesisDB is an in-memory/cache database meaning all the data is always stored in RAM. This offers performance benefits by removing calls to the filesystem and reducing complexity, but it also means if the server shutdowns all the data is lost."),(0,r.kt)("p",null,"To help this, the data can be persisted to the filesystem using the ",(0,r.kt)("a",{parentName:"p",href:"../api/sessions/sh-save"},"SH_SAVE")," command. This command writes all sessions to file so they can be restored on startup."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"SH_SAVE")," has a server config section, which defaults to:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'"session":\n{\n  "save":\n  {\n    "enabled":false,\n    "path":"./data"\n  }\n}\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"When ",(0,r.kt)("inlineCode",{parentName:"li"},"enabled")," is false, the ",(0,r.kt)("inlineCode",{parentName:"li"},"path")," is not checked so does not need to exist and ",(0,r.kt)("inlineCode",{parentName:"li"},"SH_SAVE")," is disabled"),(0,r.kt)("li",{parentName:"ul"},"When ",(0,r.kt)("inlineCode",{parentName:"li"},"enabled")," is true, the ",(0,r.kt)("inlineCode",{parentName:"li"},"path")," must exist and be a directory")),(0,r.kt)("h2",{id:"data-structure"},"Data Structure"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"SH_SAVE")," command requires a ",(0,r.kt)("inlineCode",{parentName:"p"},"name"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A directory with this name is created in ",(0,r.kt)("inlineCode",{parentName:"li"},"save::path")),(0,r.kt)("li",{parentName:"ul"},"Inside ",(0,r.kt)("inlineCode",{parentName:"li"},"name"),", a directory with the current timestamp is created, in which the data is written")),(0,r.kt)("p",null,"The purpose of creating separate directories is to allow separate save points so you can restore from a known point."),(0,r.kt)("p",null,"For example, if we send:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "SH_SAVE":\n  {\n    "name":"dump1"\n  }\n}\n')),(0,r.kt)("p",null,"A folder is created under ",(0,r.kt)("inlineCode",{parentName:"p"},"dump1"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="First save"',title:'"First','save"':!0},"\u2514\u2500\u2500 dump1\n    \u2514\u2500\u2500 1700435579410403857\n")),(0,r.kt)("p",null,"Send another ",(0,r.kt)("inlineCode",{parentName:"p"},"SH_SAVE")," with the same ",(0,r.kt)("inlineCode",{parentName:"p"},"name"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Second save"',title:'"Second','save"':!0},"\u2514\u2500\u2500 dump1\n    \u251c\u2500\u2500 1700435579410403857\n    \u2514\u2500\u2500 1700435945763630730\n")),(0,r.kt)("p",null,"A new directory is created for the second save."),(0,r.kt)("br",null),(0,r.kt)("h2",{id:"restore-data"},"Restore Data"),(0,r.kt)("p",null,"Data is loaded using the name and the newest data is always chosen. The longer term aim is to provide a method to select the data based on the name and timestamp."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"If you want to store from a particular point, use a separate name for each use of ",(0,r.kt)("inlineCode",{parentName:"p"},"SH_SAVE")," until selecting by timestamp is implemented.")),(0,r.kt)("p",null,"Restoring data is only available during startup, using the ",(0,r.kt)("inlineCode",{parentName:"p"},"--loadName")," switch:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"./nemesisdb --config=default.json --loadName=dump1\n")),(0,r.kt)("br",null),(0,r.kt)("h2",{id:"performance"},"Performance"),(0,r.kt)("p",null,"Save and restore performance is mostly governed by disk i/o performance."),(0,r.kt)("p",null,"A database with 1M sessions, with each session containing 5 keys (so 5M keys total), totalling ~385MB of data on an NVME disk:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Save: 3.7 seconds"),(0,r.kt)("li",{parentName:"ul"},"Load: 6.5 seconds")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Save and load are new features, added in version 0.3.4 (Nov 2023) so improvements will follow.\nNew features will be added such as:"),(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"Select to restore data from name and timestamp"),(0,r.kt)("li",{parentName:"ul"},"A ",(0,r.kt)("inlineCode",{parentName:"li"},"SH_LOAD")," command to restore data at runtime"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"SH_SAVE")," can persist individual sessions rather than all sessions"))))}c.isMDXComponent=!0}}]);