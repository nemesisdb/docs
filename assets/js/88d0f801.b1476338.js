"use strict";(self.webpackChunknemesisdb=self.webpackChunknemesisdb||[]).push([[4721],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>m});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)t=s[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)t=s[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var o=a.createContext({}),p=function(e){var n=a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=p(e.components);return a.createElement(o.Provider,{value:n},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},k=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,s=e.originalType,o=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(t),k=r,m=d["".concat(o,".").concat(k)]||d[k]||c[k]||s;return t?a.createElement(m,i(i({ref:n},u),{},{components:t})):a.createElement(m,i({ref:n},u))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var s=t.length,i=new Array(s);i[0]=k;var l={};for(var o in n)hasOwnProperty.call(n,o)&&(l[o]=n[o]);l.originalType=e,l[d]="string"==typeof e?e:r,i[1]=l;for(var p=2;p<s;p++)i[p]=t[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}k.displayName="MDXCreateElement"},8429:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>c,frontMatter:()=>s,metadata:()=>l,toc:()=>p});var a=t(7462),r=(t(7294),t(3905));const s={sidebar_position:3,displayed_sidebar:"tutorialSidebar"},i="Set and Get",l={unversionedId:"tutorials/first-steps-kv/setandget",id:"tutorials/first-steps-kv/setandget",title:"Set and Get",description:"We'll store data of different types. With data types part of the JSON syntax, we don't have to care about types, only that the JSON is valid.",source:"@site/docs/tutorials/first-steps-kv/setandget.md",sourceDirName:"tutorials/first-steps-kv",slug:"/tutorials/first-steps-kv/setandget",permalink:"/tutorials/first-steps-kv/setandget",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,displayed_sidebar:"tutorialSidebar"},sidebar:"tutorialSidebar",previous:{title:"Setup",permalink:"/tutorials/first-steps-kv/setup"},next:{title:"Persist",permalink:"/category/persist"}},o={},p=[{value:"String",id:"string",level:2},{value:"Array",id:"array",level:2},{value:"Multiple",id:"multiple",level:2},{value:"Get Data",id:"get-data",level:2},{value:"Clear Session Data",id:"clear-session-data",level:2},{value:"Object",id:"object",level:2},{value:"Get Object",id:"get-object",level:2},{value:"Conclusion",id:"conclusion",level:2},{value:"Considerations",id:"considerations",level:3}],u={toc:p},d="wrapper";function c(e){let{components:n,...t}=e;return(0,r.kt)(d,(0,a.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"set-and-get"},"Set and Get"),(0,r.kt)("p",null,"We'll store data of different types. With data types part of the JSON syntax, we don't have to care about types, only that the JSON is valid."),(0,r.kt)("p",null,"To interact with data, the Key Value API is used. Its commands begin ",(0,r.kt)("inlineCode",{parentName:"p"},"KV_"),"."),(0,r.kt)("h2",{id:"string"},"String"),(0,r.kt)("p",null,"Send:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "KV_SET":\n  {\n    "keys":\n    {\n      "username":"Spongebob"\n    }\n  }\n}\n')),(0,r.kt)("p",null,"The stores the key ",(0,r.kt)("inlineCode",{parentName:"p"},"username"),' with string value "Spongebob".'),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"KV_SET_RSP")," response contains ",(0,r.kt)("inlineCode",{parentName:"li"},'"username": 20'),' which is the key and status. This confirms "username" was successfully set'),(0,r.kt)("li",{parentName:"ul"},"If you send the command again, the status will change to ",(0,r.kt)("inlineCode",{parentName:"li"},"21"),", which means an existing key has been overwritten (not an error)")),(0,r.kt)("h2",{id:"array"},"Array"),(0,r.kt)("p",null,"Send:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "KV_SET":\n  {\n    "keys":\n    {\n      "friends":["Crabs","Patrick"]\n    }\n  }\n}\n')),(0,r.kt)("p",null,"This stores a key, ",(0,r.kt)("inlineCode",{parentName:"p"},"friends"),", which is an array."),(0,r.kt)("h2",{id:"multiple"},"Multiple"),(0,r.kt)("p",null,"You can store multiple keys per request:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "KV_SET":\n  {\n    "keys":\n    {\n      "email":"bob@thesea.com",\n      "age":10\n    }\n  }\n}\n')),(0,r.kt)("h2",{id:"get-data"},"Get Data"),(0,r.kt)("p",null,"To get keys use ",(0,r.kt)("inlineCode",{parentName:"p"},"KV_GET"),", which can get multiple keys in a single request:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "KV_GET":\n  {\n    "keys":["username", "email", "age", "friends"]\n  }\n}\n')),(0,r.kt)("p",null,"The response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "KV_GET_RSP":\n  {\n    "keys":\n    {\n      "username": "Spongebob",\n      "email": "bob@thesea.com",\n      "age": 10,\n      "friends":\n      [\n        "Crabs",\n        "Patrick"\n      ]\n    }\n  }\n}\n')),(0,r.kt)("p",null,"But what if we want all this in a single key? We can use an object."),(0,r.kt)("h2",{id:"clear-session-data"},"Clear Session Data"),(0,r.kt)("p",null,"Start by clearing all keys:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "KV_CLEAR":{}\n}\n')),(0,r.kt)("p",null,"The reponse contains ",(0,r.kt)("inlineCode",{parentName:"p"},"cnt"),", confirming four keys were deleted."),(0,r.kt)("h2",{id:"object"},"Object"),(0,r.kt)("p",null,"Store the same data again but in an object:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "KV_SET":\n  {\n    "keys":\n    {\n      "profile":\n      {\n        "username": "Spongebob",\n        "friends": ["Crabs","Patrick"],\n        "email":"bob@thesea.com",\n        "age":10\n      }\n    }\n  }\n}\n')),(0,r.kt)("p",null,"This stores a key, ",(0,r.kt)("inlineCode",{parentName:"p"},"profile"),", which is an object. "),(0,r.kt)("h2",{id:"get-object"},"Get Object"),(0,r.kt)("p",null,"When we want the user's profile data, we just have to get one key:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "KV_GET":\n  {\n    "keys":["profile"]\n  }\n}\n')),(0,r.kt)("h2",{id:"conclusion"},"Conclusion"),(0,r.kt)("p",null,"That's the basics of setting and getting, other common commands are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"KV_ADD")," : does not overwrite the key if it already exists"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"KV_COUNT")," : Return the number of keys present (either in the entire database or in the session, dependenent on sessions being enabled) "),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"KV_RMV")," : delete key(s)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"KV_CLEAR_SET")," : similar to ",(0,r.kt)("inlineCode",{parentName:"li"},"KV_CLEAR")," which clears all keys in the database/session (dependent on sessions being enabled), but ",(0,r.kt)("inlineCode",{parentName:"li"},"KV_CLEAR_SET")," sets new keys after the clear in a single command. This is an alternative for sending separate ",(0,r.kt)("inlineCode",{parentName:"li"},"KV_CLEAR")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"KV_SET")," commands")),(0,r.kt)("br",null),(0,r.kt)("h3",{id:"considerations"},"Considerations"),(0,r.kt)("p",null,"You need to ensure keys are unique to represent independent entities. For example, storing user data:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "KV_SET":\n  {\n    "keys":\n    {\n      "user:10:profile":\n      {\n        "username":"Monster"\n      },\n      "user:11:profile":\n      {\n        "username":"Prime"\n      }\n    }\n  }\n}\n')),(0,r.kt)("p",null,"We prefix the 'profile' key with ",(0,r.kt)("inlineCode",{parentName:"p"},"user:<number>")," to ensure a unique key name."),(0,r.kt)("p",null,"This is a disadvantage of disabling sessions. With sessions enabled:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"You create a separate session for each user"),(0,r.kt)("li",{parentName:"ul"},"To switch users, use the appropriate session token"),(0,r.kt)("li",{parentName:"ul"},"Each session has a dedicated map so keys are unique only within each session")),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"../sessions/what-is-a-session"},"tutorial")," explains further."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"It is not possible to get keys based on a pattern, the exact key name is required.")))}c.isMDXComponent=!0}}]);